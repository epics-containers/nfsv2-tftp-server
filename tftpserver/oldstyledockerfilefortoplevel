#####################
#everything below here is for TFTP
#####################
#https://go.dev/doc/install/source
#debia/ubuntu go seems messed up so have to install from outside of package manager

RUN wget https://go.dev/dl/go1.18.linux-amd64.tar.gz
RUN tar -zxvf go1.18.linux-amd64.tar.gz -C /usr/local/
# RUN echo "export PATH=/usr/local/go/bin:${PATH}" | tee /etc/profile.d/go.sh
ENV PATH=/usr/local/go/bin:${PATH}
# RUN . /etc/profile.d/go.sh
# RUN ["/bin/bash", "-c", "source /etc/profile.d/go.sh"]

# # . is sh version of source

# RUN apt install golang -y


RUN mkdir /tftpboot
ADD exportedfiles /tftpboot
WORKDIR /build
COPY tftpserver .
#debian:jessie doesnt seem to recognise go mod?? command

RUN CGO_ENABLED=1 GOOS=linux GOARCH=amd64 go build -o tftp
RUN mv /build/tftp /tftp
EXPOSE 69
EXPOSE 2049
EXPOSE 20048
EXPOSE 6900
EXPOSE 111
ENTRYPOINT ["/tftp"]